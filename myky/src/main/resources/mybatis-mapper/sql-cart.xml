<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="teamgyodong.myky.cart.mapper.CartMapper">
	
	
	<select id="selectCartList" parameterType="hashmap" resultType="teamgyodong.myky.cart.model.cart">
		
		select c.cart_id, c.user_id, c.session_id, c.created_at, ci.cart_item_id, ci.product_id, p.product_name, p.price, ci.quantity, (p.price * ci.quantity) as total_price, f.filePath
		from cart c
		join cart_item ci on c.cart_id = ci.cart_id
		join (
			select p.*, f.file_path
		    from product p  
		    left join product_file f 
		        on p.product_id = f.product_id 
		        and f.thumbnail = 'y'
		) p on ci.product_id = p.product_id
		where c.user_id = #{userId}
			
	</select>
	
</mapper>




