<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="teamgyodong.myky.partner.mapper.PartnerMapper">

	<select id="getPartnerDetailList" parameterType="hashmap" resultType="teamgyodong.myky.partner.model.partnerdetail">
			
			select * from partner_detail
			
	</select>
	
	<select id="getPartnerSiList" parameterType="hashmap" resultType="teamgyodong.myky.partner.model.partnerdetail">
		SELECT DISTINCT SI 
        FROM AREA 
	</select>
	
	<select id="getPartnerGuList" parameterType="hashmap" resultType="teamgyodong.myky.partner.model.partnerdetail">
		SELECT DISTINCT GU ,NX, NY 
        FROM AREA 
        WHERE SI = #{selectsi} AND GU IS NOT NULL
        ORDER BY GU ASC
	</select>
	
	<select id="getPartnerDongList" parameterType="hashmap" resultType="teamgyodong.myky.partner.model.partnerdetail">
		SELECT DISTINCT GU, DONG  ,NX, NY 
		FROM AREA  
		WHERE GU = #{selectgu} AND DONG IS NOT NULL
		ORDER BY DONG ASC
	</select>
	
	<select id="getPartnerHosList" parameterType="hashmap" resultType="teamgyodong.myky.partner.model.partnerdetail">
    SELECT H.HOSPITAL_NO, H.HOS_NAME, H.HOS_ADDRESS, H.PHONE, 
       MAX(A.GU) AS GU, H.NX, H.NY, MAX(F.FAVORITE_ID) AS FAVORITE_ID
	FROM ANIMAL_HOSPITAL_INFO H
	LEFT JOIN FAVORITES F ON H.HOSPITAL_NO = F.HOSPITAL_NO AND F.USER_ID = #{userId}
	LEFT JOIN AREA A ON H.HOS_ADDRESS LIKE '%' || A.GU || '%'
	WHERE 1=1
	<if test="keyword != null and keyword != ''">
	    AND H.HOS_NAME LIKE '%' || #{keyword} || '%'
	</if>    
	<if test="keyword == ''">
	    AND A.GU = #{selectgu} AND A.GU IS NOT NULL
	</if>
	GROUP BY H.HOSPITAL_NO, H.HOS_NAME, H.HOS_ADDRESS, H.PHONE, H.NX, H.NY
</select>


	

	<select id="getPartnerList" parameterType="hashmap" resultType="teamgyodong.myky.partner.model.partnerdetail">
		SELECT DISTINCT PARTNER_DETAIL_ID, NAME,PHONE_NUMBER, ADDRESS, NX, NY,RESERVATION_URL, OPENING_HOURS,REGULAR_HOLIDAY 
		FROM PARTNER_DETAIL
	</select>

	<select id="getfavoriteList" parameterType="hashmap" resultType="teamgyodong.myky.partner.model.partnerdetail">
		SELECT A.* ,F.*
		FROM FAVORITES F
		INNER JOIN ANIMAL_HOSPITAL_INFO A ON F.HOSPITAL_NO = A.HOSPITAL_NO
		WHERE F.USER_ID = #{userId}
	</select>

	<insert id="addfavorites" parameterType="hashmap"  useGeneratedKeys="true" keyColumn="HOSPITAL_NO" keyProperty="hospitalNo">
		INSERT INTO FAVORITES (FAVORITE_ID,HOSPITAL_NO,USER_ID)
		VALUES (FAVORITES_SEQ.NEXTVAL,#{hospitalNo},#{userId})
	</insert>

	<delete id="favoritesDelete" parameterType="hashmap">
		DELETE FROM FAVORITES
		WHERE HOSPITAL_NO = #{hospitalNo}
	</delete>


	<select id="favorList" parameterType="hashmap" resultType="teamgyodong.myky.partner.model.partnerdetail">
		SELECT A.* ,F.*
		FROM FAVORITES F
		INNER JOIN ANIMAL_HOSPITAL_INFO A ON F.HOSPITAL_NO = A.HOSPITAL_NO
		WHERE F.USER_ID = #{userId}
	</select>
</mapper>




