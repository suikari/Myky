<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="teamgyodong.myky.membership.mapper.MembershipMapper">
	
	<select id="selectMembershipInfo" parameterType="hashmap" resultType="teamgyodong.myky.membership.model.Membership">
		
		select * from membership
		where user_id = #{userId}
		
	</select>

	<select id="selectValidMembership" parameterType="hashmap" resultType="teamgyodong.myky.membership.model.Membership">
		
		select membership_type, expiration_date
		from membership
		where user_id = #{userId} and expiration_date >= sysdate
		
	</select>
	
	<update id="updateDonationYn" parameterType="hashmap">
	
		update membership
		set
			donation_yn = #{donationYn}
		where user_id = #{userId}
	
	</update>

	<select id="selectMemberCnt" parameterType="hashmap" resultType="int">
		
		SELECT COUNT(*)
	    FROM MEMBERSHIP M
	    INNER JOIN USERS U ON U.USER_ID = M.USER_ID
	    WHERE M.IS_CANCELED = 'N'
		
	</select>
	
	<select id="getTotalAmount" parameterType="hashmap" resultType="int">
		
	  SELECT NVL(SUM(
	    CASE 
	      WHEN MONTHS_BETWEEN(SYSDATE, TO_DATE(RENEWAL_DATE, 'YY/MM/DD')) &lt; 0 THEN 0
	      ELSE FLOOR(MONTHS_BETWEEN(SYSDATE, TO_DATE(RENEWAL_DATE, 'YY/MM/DD'))) * 3000
	    END
	  ), 0)
	  FROM MEMBERSHIP
	  WHERE IS_CANCELED = 'N'

	</select>
	
</mapper>




